{"version":3,"sources":["../src/index.ts"],"sourcesContent":["import type { PluginObj, NodePath } from '@babel/core';\nimport type {\n  ImportDeclaration,\n  ImportSpecifier,\n  ImportDefaultSpecifier,\n  ImportNamespaceSpecifier\n} from '@babel/types';\nimport * as t from '@babel/types';\nimport type { PluginConfig } from './types';\nimport { transformFilename, configMatches, validateConfig } from './transform';\n\n/**\n * Babel 插件：转换导入声明\n */\nexport default function transformImportDeclarationPlugin(): PluginObj {\n  return {\n    name: 'transform-import-declaration',\n\n    visitor: {\n      Program: {\n        enter(_, state) {\n          // 在程序开始时验证配置\n          const config = state.opts as PluginConfig;\n          if (!config || !config.config) {\n            throw new Error('Missing plugin configuration');\n          }\n          validateConfig(config.config);\n        }\n      },\n\n      ImportDeclaration(path: NodePath<ImportDeclaration>, state) {\n        const config = state.opts as PluginConfig;\n        const node = path.node;\n\n        // Skip type-only imports (e.g., import type { Foo } from 'bar')\n        if (node.importKind === 'type') {\n          return;\n        }\n\n        // 获取源模块名称\n        const source = node.source.value;\n\n        // 查找所有匹配此 source 的配置\n        const matchingConfigs = config.config.filter(c => c.source === source);\n\n        if (matchingConfigs.length === 0) {\n          return;\n        }\n\n        // 收集需要转换的命名导入 (排除 type-only 导入)\n        const namedImports = node.specifiers.filter(\n          spec => spec.type === 'ImportSpecifier' && spec.importKind !== 'type'\n        ) as ImportSpecifier[];\n\n        if (namedImports.length === 0) {\n          return;\n        }\n\n        // 收集未被处理的导入说明符 (包括非命名导入和 type-only 导入)\n        const unprocessedSpecifiers: (ImportDefaultSpecifier | ImportNamespaceSpecifier | ImportSpecifier)[] =\n          node.specifiers.filter(spec =>\n            spec.type !== 'ImportSpecifier' || spec.importKind === 'type'\n          );\n\n        // 创建新的导入声明\n        const newImports: any[] = [];\n\n        // 处理每个命名导入\n        namedImports.forEach(specifier => {\n          const importedName = specifier.imported.type === 'Identifier'\n            ? specifier.imported.name\n            : specifier.imported.value;\n          const localName = specifier.local.name;\n\n          // 尝试找到第一个匹配的配置\n          let matchedConfig = null;\n          for (const cfg of matchingConfigs) {\n            if (configMatches(cfg, importedName)) {\n              matchedConfig = cfg;\n              break;\n            }\n          }\n\n          if (!matchedConfig) {\n            // 如果没有匹配的配置，保留原始导入\n            unprocessedSpecifiers.push(specifier);\n            return;\n          }\n\n          // 转换文件名\n          const filename = transformFilename(importedName, matchedConfig.filename);\n\n          // 生成导入路径\n          const paths = matchedConfig.output.map(template =>\n            template.replace(/\\{\\{\\s*filename\\s*\\}\\}/g, filename)\n          );\n\n          // 确定导入说明符类型\n          const specifierType = matchedConfig.specifier || 'default';\n\n          // 第一个路径：主导入（根据 specifier 类型）\n          if (paths.length > 0) {\n            const mainPath = paths[0];\n\n            switch (specifierType) {\n              case 'default':\n                // import Button from 'path'\n                newImports.push(\n                  t.importDeclaration(\n                    [t.importDefaultSpecifier(\n                      t.identifier(localName)\n                    )],\n                    t.stringLiteral(mainPath)\n                  )\n                );\n                break;\n\n              case 'named':\n                // import { Button } from 'path'\n                newImports.push(\n                  t.importDeclaration(\n                    [t.importSpecifier(\n                      t.identifier(localName),\n                      t.identifier(importedName)\n                    )],\n                    t.stringLiteral(mainPath)\n                  )\n                );\n                break;\n\n              case 'namespace':\n                // import * as Button from 'path'\n                newImports.push(\n                  t.importDeclaration(\n                    [t.importNamespaceSpecifier(\n                      t.identifier(localName)\n                    )],\n                    t.stringLiteral(mainPath)\n                  )\n                );\n                break;\n            }\n          }\n\n          // 其余路径：副作用导入\n          for (let i = 1; i < paths.length; i++) {\n            newImports.push(\n              t.importDeclaration(\n                [],\n                t.stringLiteral(paths[i])\n              )\n            );\n          }\n        });\n\n        // 如果所有导入都被处理了，替换原始导入\n        if (unprocessedSpecifiers.length === 0) {\n          path.replaceWithMultiple(newImports);\n        } else {\n          // 保留未处理的导入，并添加新的导入\n          node.specifiers = unprocessedSpecifiers;\n          path.insertAfter(newImports);\n        }\n      }\n    }\n  };\n}\n"],"names":["transformImportDeclarationPlugin","name","visitor","Program","enter","_","state","config","opts","Error","validateConfig","ImportDeclaration","path","node","importKind","source","value","matchingConfigs","filter","c","length","namedImports","specifiers","spec","type","unprocessedSpecifiers","newImports","forEach","specifier","importedName","imported","localName","local","matchedConfig","cfg","configMatches","push","filename","transformFilename","paths","output","map","template","replace","specifierType","mainPath","t","importDeclaration","importDefaultSpecifier","identifier","stringLiteral","importSpecifier","importNamespaceSpecifier","i","replaceWithMultiple","insertAfter"],"mappings":"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"}